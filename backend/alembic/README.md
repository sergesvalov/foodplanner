# ü¶Ö Alembic Migrations Guide (Backend)

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤. –û–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ–µ–∫—Ç–µ FoodPlanner.

## üìç –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

*   **–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** –í—Å–µ –∫–æ–º–∞–Ω–¥—ã Alembic –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∏–∑ –ø–∞–ø–∫–∏ `backend/`.
*   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `backend/alembic.ini` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (`sqlite:////app/data/menu_planner.db` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
*   **–û–∫—Ä—É–∂–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:** `backend/alembic/env.py` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–µ–π.
    *   **–í–∞–∂–Ω–æ –¥–ª—è AI:** –ï—Å–ª–∏ –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ `env.py` (–∏–ª–∏ –≤ `backend/database.py`, –∫–æ—Ç–æ—Ä—ã–π –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ `env.py`), –∏–Ω–∞—á–µ `autogenerate` –Ω–µ —É–≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.
*   **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –°–∫—Ä–∏–ø—Ç `backend/fast_migrate.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö (–≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

–í—ã–ø–æ–ª–Ω—è–π—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `backend/`:

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ (–†–µ–≤–∏–∑–∏—è)

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (`models.py`, `schemas.py` –∏ —Ç.–¥.):

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–æ–¥–µ–ª—è—Ö
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü–µ)"
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ `backend/alembic/versions/`!
–ò–Ω–æ–≥–¥–∞ Alembic –º–æ–∂–µ—Ç:
*   –ù–µ –∑–∞–º–µ—Ç–∏—Ç—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ (–∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é + —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é).
*   –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (SQLite –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è).
*   –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç).

### 2. –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Workflow)

–î–æ–ø—É—Å—Ç–∏–º, –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `is_active` –≤ –º–æ–¥–µ–ª—å `User`.

1.  **–ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥:** –í `backend/models.py` –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ:
    ```python
    is_active = Column(Boolean, default=True)
    ```
2.  **–°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:**
    ```bash
    alembic revision --autogenerate -m "add_is_active_to_users"
    ```
3.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:** –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ `backend/alembic/versions/`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–º –µ—Å—Ç—å `op.add_column('users', ...)`.
4.  **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ:**
    ```bash
    alembic upgrade head
    ```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Å—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ (Data Migration)

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å *–¥–∞–Ω–Ω—ã–µ*, –∞ –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É –∑–Ω–∞—á–µ–Ω–∏—è–º–∏):

1.  –°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é:
    ```bash
    alembic revision -m "populate_initial_data"
    ```
2.  –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é, –∏—Å–ø–æ–ª—å–∑—É—è SQL –∫–æ–º–∞–Ω–¥—ã:
    ```python
    def upgrade():
        op.execute("UPDATE users SET is_active = 1")
    ```



### 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (Upgrade)

–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```bash
alembic upgrade head
```

### 5. –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (Downgrade)

–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é (—à–∞–≥ –Ω–∞–∑–∞–¥):

```bash
alembic downgrade -1
```

–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
```bash
alembic downgrade <revision_id>
```

---

## ü§ñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI (Context for LLMs)

–ï—Å–ª–∏ –≤—ã AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏ –≤–∞–º –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –ë–î:

1.  **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ `models.py`:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª—è—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (SQLAlchemy 2.0 style).
2.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `env.py`:** –£–¥–æ—Å—Ç–æ–≤–µ—Ä—å—Ç–µ—Å—å, —á—Ç–æ Base.metadata "–≤–∏–¥–∏—Ç" –≤–∞—à–∏ –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏.
3.  **–°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `alembic revision --autogenerate`.
4.  **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `read_file`, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `backend/alembic/versions/`.
    *   –ï—Å–ª–∏ —Ñ–∞–π–ª –ø—É—Å—Ç–æ–π (—Ç–æ–ª—å–∫–æ `pass`), –∑–Ω–∞—á–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã -> –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–ø–æ—Ä—Ç—ã.
    *   –ï—Å–ª–∏ –µ—Å—Ç—å `op.drop_table` –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—É—é –≤—ã –Ω–µ —É–¥–∞–ª—è–ª–∏ -> –í–ù–ò–ú–ê–ù–ò–ï! –í–æ–∑–º–æ–∂–Ω–æ, Alembic –Ω–µ –≤–∏–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É.
5.  **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:** `alembic upgrade head`.

---

## üõ† –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫ (Troubleshooting)

### "Target database is not up to date"
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –≤ –±–∞–∑–µ –µ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, –∏–ª–∏ —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–∞–ø–∫–æ–π `versions`.
*   **–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `alembic upgrade head`.

### "Table already exists" –∏–ª–∏ "Column not found"
–í–æ–∑–Ω–∏–∫–∞–µ—Ç, –µ—Å–ª–∏ –≤—ã –ø—Ä–∞–≤–∏–ª–∏ –ë–î –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —É–¥–∞–ª—è–ª–∏ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π, –Ω–æ –Ω–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–ª–∏ –±–∞–∑—É.
*   **–†–µ—à–µ–Ω–∏–µ (SQLite):** –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –¥–ª—è dev-—Å—Ä–µ–¥—ã ‚Äî —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª `menu_planner.db` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–Ω–æ–≤–æ (`alembic upgrade head`).
*   **–†–µ—à–µ–Ω–∏–µ (Prod):** –ü–æ–º–µ—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL: `alembic stamp head` (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!).

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π (Multiple heads)
–ï—Å–ª–∏ –¥–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–∑–¥–∞–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ—Ç –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –≤–µ—Ä—Å–∏–∏.
*   **–†–µ—à–µ–Ω–∏–µ:** `alembic merge heads -m "merge conflict"`

---

## üåç –†–∞–±–æ—Ç–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (Docker)

–í —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—á–µ—Ä–µ–∑ `fast_migrate.py`).
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ `docker-compose up` —Å–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏.

### –°—Ü–µ–Ω–∞—Ä–∏–π –ê: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–µ–ø–ª–æ–π (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

1.  **–õ–æ–∫–∞–ª—å–Ω–æ:** –í—ã –≤–Ω–æ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª–∏.
2.  **–õ–æ–∫–∞–ª—å–Ω–æ:** –°–æ–∑–¥–∞–µ—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é: `alembic revision --autogenerate -m "new_feature"`.
3.  **–õ–æ–∫–∞–ª—å–Ω–æ:** –ö–æ–º–º–∏—Ç–∏—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø—É—à–∏—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
4.  **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:** –î–µ–ª–∞–µ—Ç–µ `git pull`.
5.  **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
    ```bash
    docker-compose down
    docker-compose up -d --build
    ```
    *–°–∫—Ä–∏–ø—Ç `fast_migrate.py` —É–≤–∏–¥–∏—Ç –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –µ—ë.*

### –°—Ü–µ–Ω–∞—Ä–∏–π –ë: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –Ω–æ –∫–æ–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ volume), –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤–Ω—É—Ç—Ä–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
docker exec -it menu_backend alembic upgrade head
```

### –°—Ü–µ–Ω–∞—Ä–∏–π –í: –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –≤—ã –ø—Ä–∞–≤–∏—Ç–µ –∫–æ–¥ –ø—Ä—è–º–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (production editing), `fast_migrate.py` –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å–∞–º –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ.
*   **–†–∏—Å–∫:** –§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—Å—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ï—Å–ª–∏ volume –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–∞, —Ñ–∞–π–ª –ø—Ä–æ–ø–∞–¥–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
*   **–í —Ç–µ–∫—É—â–µ–º `docker-compose.yml`:** –ü–∞–ø–∫–∞ `backend` –ø—Ä–æ–∫–∏–Ω—É—Ç–∞ –∫–∞–∫ volume, —Ç–∞–∫ —á—Ç–æ —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞. –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –µ–≥–æ –≤ git –≤—Ä—É—á–Ω—É—é.

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ç–æ—Ä–∞:

```bash
docker logs menu_backend
```

---

## üìÇ –§–∞–π–ª—ã
*   `backend/alembic.ini`: –ö–æ–Ω—Ñ–∏–≥.
*   `backend/alembic/env.py`: –°–∫—Ä–∏–ø—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è.
*   `backend/alembic/script.py.mako`: –®–∞–±–ª–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–∏.

---

## üêç –ú–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Python (–ï—Å–ª–∏ CLI –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ `alembic` –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—É—Ç—è–º–∏ –≤ Windows/Docker), –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Python-—Å–∫—Ä–∏–ø—Ç.

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `fast_migrate.py`

–í –∫–æ—Ä–Ω–µ `backend/` —É–∂–µ –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π:

```bash
python fast_migrate.py
```

### 2. –°–≤–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–∞–Ω–¥—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞—Ç—å —Ä–µ–≤–∏–∑–∏—é), —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `manual_migrate.py` –≤ –ø–∞–ø–∫–µ `backend/`:

```python
from alembic.config import Config
from alembic import command

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥
alembic_cfg = Config("alembic.ini")

# --- –í–´–ë–ï–†–ò–¢–ï –ù–£–ñ–ù–û–ï –î–ï–ô–°–¢–í–ò–ï ---

# 1. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (revision)
# command.revision(alembic_cfg, message="manual_fix", autogenerate=True)

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (upgrade)
command.upgrade(alembic_cfg, "head")

# 3. –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (downgrade)
# command.downgrade(alembic_cfg, "-1")
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ:
```bash
python manual_migrate.py
```
